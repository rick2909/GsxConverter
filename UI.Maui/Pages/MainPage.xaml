<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:json="clr-namespace:GsxConverter.Models.Json;assembly=GsxConverter"
             x:Class="UI.Maui.Pages.MainPage"
             Title="GSX Converter">
  <ContentPage.Content>
    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" ColumnDefinitions="*" Padding="10" RowSpacing="8">
      <HorizontalStackLayout Grid.Row="0" Spacing="8">
        <Button Text="Open GSX File..." Clicked="OnOpenGsxFileClicked" />
        <Button Text="Convert" Clicked="OnConvertClicked" />
        <Label x:Name="FileTypeLabel" Text="" VerticalOptions="Center" FontAttributes="Italic" />
      </HorizontalStackLayout>

      <!-- Top: show the jetway_rootfloor_heights config (if present) -->
      <StackLayout Grid.Row="1" Orientation="Vertical" Padding="0,4,0,4">
        <Label Text="Config: [jetway_rootfloor_heights]" FontAttributes="Bold" />
        <Editor x:Name="ConfigEditor" AutoSize="TextChanges" HeightRequest="80" IsReadOnly="True" />
        <Label Text="De-Ice entries" FontAttributes="Bold" Margin="0,6,0,0" />
        <CollectionView x:Name="DeIceCollection" HeightRequest="80">
          <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="json:DeIceDefinition">
              <StackLayout Orientation="Horizontal" Padding="4">
                <Label Text="{Binding Id}" />
                <Label Text=", " />
                <Label Text="{Binding Type}" />
              </StackLayout>
            </DataTemplate>
          </CollectionView.ItemTemplate>
        </CollectionView>
        <Label TextColor="Red" IsVisible="False" />
      </StackLayout>

      <Grid Grid.Row="2" ColumnDefinitions="Auto,*" ColumnSpacing="8" VerticalOptions="Center">
        <Label Grid.Column="0" Text="Output:" VerticalOptions="Center" />
        <Entry Grid.Column="1" x:Name="OutputPathEntry" />
      </Grid>

      <Grid Grid.Row="3" ColumnDefinitions="300,8,*">
        <StackLayout Grid.Column="0">
          <Label Text="Parsed Gates" FontAttributes="Bold" />
          <CollectionView x:Name="GatesCollection" SelectionMode="Single" SelectionChanged="OnGateSelectionChanged" HeightRequest="500">
            <CollectionView.ItemTemplate>
              <DataTemplate x:DataType="json:GateDefinition">
                <Border Padding="8" Margin="4" BackgroundColor="LightGray">
                  <StackLayout>
                    <Label Text="{Binding GateId}" FontAttributes="Bold"/>
                    <Label Text="{Binding Position.Latitude, StringFormat='Lat: {0:F6}'}" FontSize="Small" />
                    <Label Text="{Binding Position.Longitude, StringFormat='Lon: {0:F6}'}" FontSize="Small" />
                    <Label Text="{Binding Services.Count, StringFormat='Services: {0}'}" FontSize="Small" />
                    <StackLayout Orientation="Horizontal" Spacing="4">
                      <Label Text="Jetway" FontSize="Micro" BackgroundColor="Green" TextColor="White" Padding="2" IsVisible="{Binding HasJetway}" />
                      <Label Text="Waypoints" FontSize="Micro" BackgroundColor="Blue" TextColor="White" Padding="2" x:Name="WaypointsLabel" />
                    </StackLayout>
                  </StackLayout>
                </Border>
              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>
        </StackLayout>

        <BoxView Grid.Column="1" />

        <StackLayout Grid.Column="2">
          <Label Text="JSON Preview" FontAttributes="Bold" />
          <Editor x:Name="JsonPreviewEditor" AutoSize="TextChanges" HeightRequest="500" IsReadOnly="True"/>
        </StackLayout>
      </Grid>

      <Label Grid.Row="4" x:Name="StatusLabel" Text="Ready" />
    </Grid>
  </ContentPage.Content>
</ContentPage>