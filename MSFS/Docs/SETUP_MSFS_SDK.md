# MSFS SDK Setup and Packaging Guide

This guide explains how to install the MSFS SDK, package the GSX Native Panel, and import it into the simulator.

## Known Issues with MSFS 2024 - RESOLVED! ✅

**Solution Found:** InGamePanels require SPB (Single Package Binary) compilation using a specific XML structure.

### Working Solution (October 28, 2025):

The panel now works correctly using the proper MSFS InGamePanel template structure:

1. ✅ **PackageSources XML** with `<SimBase.Document Type="InGamePanels">` structure
2. ✅ **SPB compilation** creates the required `.spb` binary file  
3. ✅ **Custom element registration** using `window.customElements.define()` and `checkAutoload()`
4. ✅ **TemplateElement** class extension instead of standalone HTML
5. ✅ **Toolbar icon SVG** in `html_ui/Textures/Menu/toolbar/`
6. ✅ **ingame-ui element** with `panel-id` attribute instead of standalone panel.xml

### Key Files Structure:
```
PackageSources/InGamePanels/
  ingamepanel-groundequipment.xml     # SPB source definition
html_ui/
  InGamePanels/gsx-native-panel/
    index.html                         # Uses <ingame-ui> element
    js/main.js                         # Extends TemplateElement
  Textures/Menu/toolbar/
    ICON_TOOLBAR_GROUND_EQUIPMENT.svg  # Toolbar icon
InGamePanels/
  ingamepanel-groundequipment.spb      # Compiled binary (auto-generated)
```

### Reference Template:
Based on [msfs2020-toolbar-window-template](https://github.com/bymaximus/msfs2020-toolbar-window-template)

## 1) Install the MSFS SDK

- Launch Microsoft Flight Simulator
- Open Developer Mode: Options > General Options > Developers > Turn On Developer Mode
- In the DevMode menu bar (top), choose Help > SDK Installer to download the SDK
- Run the SDK installer, then relaunch MSFS

Verify the SDK tools
- FSPackagetool should be installed in the SDK folder (varies by install)
  - Typical: C:\MSFS 2024 SDK\bin\FSPackagetool\fspackagetool.exe

## 2) Project Layout (this repo)

- MSFS/gsx-native-panel
  - manifest.json, layout.json (generated by packaging), PackageDefinitions.xml, PackageSources.xml
  - html_ui/InGamePanels/gsx-native-panel: panel.xml, index.html, css, js
  - assets/airports: JSON profiles
- MSFS/gsx-bridge: local .NET app the panel can call for sim data/actions

## 3) Packaging the in-game panel

Use FSPackagetool to create a proper package with layout.json
- Open a command prompt or PowerShell
- Change directory to MSFS/gsx-native-panel
- Run the packager and point to manifest.json

Example (PowerShell):
- & "C:\\MSFS 2024 SDK\\bin\\Tools\\FSPackagetool\\fspackagetool.exe" .\\manifest.json

Results
- A packaged build folder will be created with a layout.json
- Copy the resulting package folder to your Community folder

Community folder paths (examples)
- MS Store: %LocalAppData%\Packages\Microsoft.FlightSimulator_8wekyb3d8bbwe\LocalCache\Packages\Community
- Steam: %AppData%\Microsoft Flight Simulator\Packages\Community
- If you set a custom Packages path, use that Community folder instead

## 4) Using the panel in-sim

- Launch MSFS
- Open the toolbar and click on "GSX"
- The panel loads assets/airports/eham.sample.json by default
- You can extend the dropdown or add auto-detect via the local bridge

## 5) Local bridge (optional for MVP)

- The bridge provides endpoints for the panel to read sim data or trigger actions
- Build/run: dotnet run --project ..\\gsx-bridge\\Gsx.Bridge.csproj
- Health check: http://localhost:8787/api/health

## 6) Next steps

- Wire SimConnect in the bridge for: current ICAO, parking stands, ground actions
- Replace sample JSON with profile-less mode by reading sim data
- Optionally migrate deep actions to a WASM module

Troubleshooting
- If the panel does not appear: ensure the package is inside Community and has a valid layout.json
- If actions do nothing: verify the bridge is running and reachable; the MVP endpoints are stubs until SimConnect is integrated
